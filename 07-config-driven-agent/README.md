# 07-Config-Driven-Agent

A config-driven orchestrator that reads `config/agents.json` to manage agent capabilities and policies, then dispatches tasks to specialized sub-agents:

- **Smoke‑Test Agent** → writes `tests/smoke.auto.test.ts`
- **Mermaid Agent** → writes `mermaid/mermaid.md` with flow diagrams
- **README Agent** → writes `README.auto.md` with comprehensive documentation

No MCP; runs purely on npm + TypeScript + Vitest with configuration-based agent management.

## TL;DR

```bash
cd 07-config-driven-agent
npm install
npm run agent    # Config-driven orchestrator reads config/agents.json and ./instructions.md
npm test         # Run generated smoke tests
# Check outputs/ directory for all generated content
```

## Goals

✅ Demonstrate config-driven agent management with policies  
✅ Add README generation agent for comprehensive documentation  
✅ Validate agent capabilities against configuration  
✅ Prepare foundation for MCP-style permissions

## Project Structure

```
07-config-driven-agent/
├─ .gitignore               # ignores generated files
├─ package.json
├─ tsconfig.json
├─ instructions.md          # freeform instructions (HE/EN)
├─ README.md                # this file
├─ config/
│  └─ agents.json          # agent configuration and policies
├─ src/
│  ├─ index.ts             # auto generated sample file
│  └─ math.ts              # math utility functions
├─ outputs/                 # all generated content
│  ├─ tests/
│  │  └─ smoke.auto.test.ts   # generated by smoke-agent.ts
│  ├─ mermaid/
│  │  └─ mermaid.md          # generated by mermaid-agent.ts
│  └─ README.auto.md         # generated by readme-agent.ts
└─ agent/
   ├─ orchestrator.ts       # config-driven orchestrator
   ├─ smoke-agent.ts        # creates tests/smoke.auto.test.ts
   ├─ mermaid-agent.ts      # creates mermaid/mermaid.md
   └─ readme-agent.ts       # creates README.auto.md
```

## Agent Configuration

The `config/agents.json` file defines:

### Agent Capabilities
- **smoke-test-agent**: `["tests", "smoke"]`
- **mermaid-agent**: `["docs", "diagram", "mermaid", "flow"]`  
- **readme-agent**: `["docs", "readme", "documentation"]`

### Security Policies
Each agent has restricted permissions:
- **network**: `false` (no network access)
- **shell**: `false` (no shell commands)
- **fs**: `"restricted"` (limited file system access)
- **writePaths**: Allowed write locations
- **denyPaths**: Forbidden directories

## How it Works

1. **Orchestrator** loads `config/agents.json` and validates agent capabilities
2. **Instructions** are parsed from `instructions.md` for task detection
3. **Validation** ensures requested tasks match agent capabilities
4. **Dispatch** sends tasks to appropriate specialized agents
5. **Agents** operate within their configured security policies

## Intent Detection

Supports English/Hebrew keywords:
- **Smoke tests**: "smoke tests", "בדיקות עשן", "create test"
- **Flow diagrams**: "mermaid", "flow chart", "diagram", "תרשים"  
- **Documentation**: "readme", "documentation", "docs", "תיעוד"
- **Summary**: "summary", "סיכום", "overview"

## Usage

```bash
# Install dependencies
npm install

# Run the config-driven orchestrator
npm run agent

# Execute generated tests
npm test

# View generated content
cat outputs/README.auto.md           # Auto-generated documentation
cat outputs/mermaid/mermaid.md       # Visual flow diagrams
cat outputs/tests/smoke.auto.test.ts # Comprehensive test suite
```

## Key Improvements from Chapter 06

1. **Configuration Management**: Centralized agent config with capabilities and policies
2. **README Agent**: Automatic documentation generation
3. **Security Policies**: File system restrictions and access controls
4. **Capability Validation**: Ensures agents can perform requested tasks
5. **MCP Preparation**: Foundation for Model Context Protocol integration

## Example Output

The orchestrator will:
1. Load agent configurations from `config/agents.json`
2. Validate agent capabilities against requested tasks
3. Dispatch to Smoke-Test Agent → comprehensive tests
4. Dispatch to Mermaid Agent → visual diagrams  
5. Dispatch to README Agent → project documentation
6. Generate summary if requested

All agents operate within their configured security policies!